# forms
Websites generally consist of 3 main elements: paragraph text, lists and forms.
While paragraph text is generally straight forward to place on a page, lists &
forms require some more work. This section explains everything you need to know
to work with forms in Choo.

This guide assumes you're working from a project generated by `create-choo-app`.
This allows us to write inline CSS, which makes examples a little simpler to
read. However our goal is to provide you with knowledge that translates to any
setup - even if you don't end up using Choo.

## How do forms work?
Before we dive into how forms work in Choo, let's dive into how forms work on
pages that don't use any JavaScript. A lot of the web was designed to work
without JavaScript, and to submit forms, you don't need any JS at all. Knowing
what the default behavior is of forms allows us to build on top of it, rather
than trying to rewrite functionality that's already available to us.

### The Form Element
Forms are declared using the form tag. By themselves they don't do much, but
they have a few important attributes that are good to know about.

The first attribute is `method=""`. This tells the form which HTTP method to
use. By default it's set to `POST`, so often it's not needed to define this.

The second attribute is `action=""`. This attribute tells the form where to
redirect the page to when the submission was successful.

Forms also always should have an `id=""` attribute on them. This makes them
easier to debug, and shows up in the payload that's sent to the server.

```html
<form id="login" action="/dashboard">
</form>
```

### The Input Element
Forms need data. And `<input>` elements provide that data. As a rule, each
`<input>` element has a `type=""` attribute, and an accompanying `<label>`
element. They also need a `name=""` and an `id=""`. That's quite a bit of data
required. But together it allows you to create a wide range of input.

```html
<form id="login" action="/dashboard">
  <label for="username">username</label>
  <input id="username" name="username" type="text">
  <label for="password">password</label>
  <input id="password" name="password" type="password">
  <input type="submit" value="Login">
</form>
```

### Validating Input
Forms come with a wide range of validation built in. Probably the biggest
benefit is that it works on all platforms, with little effort.  It respects user
settings such as font-size, and supports screen readers out of the box.

To validate the form's input fields, there's a few attributes we can use:
- `pattern` - validate the form's input field using a Regular Expression. For
  example `pattern="^.{1,15}$"` makes sure strings have a length of at least 1,
  and not more than 15.
- `required` - make sure that the field is filled in, and valid.
- `title` - the message to display if the `pattern` attribute is invalid. This
  is useful for users that can't read RegExes in their error messages (e.g.
  everyone).

Together these allow you to express a wide range of validation, and make sure
your forms are filled in correctly and are accessible. Let's see what that
that looks like:

```html
<form id="login" action="/dashboard">
  <label for="username">
    username
  </label>
  <input id="username" name="username"
    type="text"
    required
    pattern=".{1,36}"
    title="Username must be between 1 and 36 characters long."
  >
  <label for="password">
    password
  </label>
  <input id="password" name="password"
    type="password"
    required
  >
  <input type="submit" value="Login">
</form>
```

## Handling Form Submissions
So far we've seen how to create basic HTML forms with validation. This is a
great starting point, but often we'll want to control submissions using
javascript.

Perhaps we can pre-populate some input fields. Perhaps there's input fields that
rely on the values of other input fields. Starting off with JS from the start
allows us to change the behavior without needing to change the architecture.

Creating forms with Choo is almost identical to basic HTML. The main difference
is that we create a `'submit'` event handler, and we control sending the data
using `window.fetch()`.

```js
var choo = require('choo')

var app = choo()
app.route('/', main)
app.mount('body')

function main () {                                                    // 1.
  return html`
    <body>
      <form id="login" onsubmit=${onsubmit}>
        <label for="username">
          username
        </label>
        <input id="username" name="username"
          type="text"
          required
          pattern=".{1,36}"
          title="Username must be between 1 and 36 characters long."
        >
        <label for="password">
          password
        </label>
        <input id="password" name="password"
          type="password"
          required
        >
        <input type="submit" value="Login">
      </form>
    </body>
  `

  function onsubmit (e) {                                            // 2.
    var form = document.getElementbyId('login')                      // 3.
    var data = new window.FormData(form)                             // 4.
    fetch('/dashboard', { method: 'POST', body: data })              // 5.
      .then(res => console.log('request ok \o/'))
      .catch(err => console.log('oh no!'))
  }
}
```

1. We create a basic Choo app, and a single view that renders a `<form>`
   element. Inside it we listen for the `'submit'` event by setting the
   `onsubmit=` attribute.
2. We create a handler for the `'submit'` event. This will fire whenever a user
   clicks the `type="submit"` button (or something similar).
3. When the `onsubmit` function fires, we select the form element.
4. Now that we have the `<form>` element, we can extract all values using
   `window.FormData()`. It gives us back a special object containing all the
   form data that we can directly pass to the `fetch()` api. It even works in
   all browsers!
5. Now that we have our data, we can make a request to the server.

// NOTE(yw): figure out if we can send FormData() as `application/json`. This is
kinda the point lmao haha.

__note: People used to working with DOM events might wonder why we don't use
`e.target` instead of `document.getElementById`. Because the `'submit'` event
can be triggered not only from the `type="submit"` button, it's safer and
simpler to select the form by id rather than try and find the right parent node.
Not ideal, but straight forward.__
